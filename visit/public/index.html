<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LG Science Park 방문 안내</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
  <style>
    :root {
      --lg-red: #a50034;
      --lg-light-red: #f8d7e0;
      --lg-dark: #333;
      --lg-light: #f8f9fa;
      --lg-gray: #e9ecef;
      --lg-accent: #00a5e4;
    }
    
    body {
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      color: #333;
    }
    
    .section {
      margin-bottom: 2rem;
      break-inside: avoid;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: 1px solid #e5e7eb;
      margin-bottom: 1rem;
    }
    
    .section-title {
      color: var(--lg-red);
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.875rem;
      transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--lg-accent);
      box-shadow: 0 0 0 3px rgba(0, 165, 228, 0.1);
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--lg-red), #8c002c);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(165, 0, 52, 0.3);
    }
    
    .btn-secondary {
      background: white;
      color: #374151;
      border: 2px solid #e5e7eb;
    }
    
    .btn-secondary:hover {
      background: #f9fafb;
    }
    
    .drag-drop-area {
      border: 3px dashed #d1d5db;
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .drag-drop-area:hover {
      border-color: var(--lg-accent);
      background-color: rgba(0, 165, 228, 0.05);
    }
    
    .drag-drop-area.dragover {
      border-color: var(--lg-red);
      background-color: rgba(165, 0, 52, 0.05);
    }
    
    .drag-drop-area.disabled {
      opacity: 0.5;
      pointer-events: none;
      background: #f5f5f5;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      border: 1px solid #e9ecef;
    }
    
    .file-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .file-remove {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
    }
    
    .operator-badge {
      display: inline-flex;
      align-items: center;
      background: linear-gradient(135deg, #e8f4f8, #d1ecf1);
      color: #0c5460;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      margin: 0.25rem;
      font-weight: 500;
    }
    
    .operator-badge .num {
      margin-left: 0.4rem;
      font-weight: 700;
      background: #0c5460;
      color: white;
      padding: 0.1rem 0.4rem;
      border-radius: 10px;
      font-size: 0.7rem;
    }
    
    .equipment-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 80px 2fr auto;
      gap: 0.75rem;
      margin-bottom: 1rem;
      align-items: center;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.5rem 0;
      cursor: pointer;
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--lg-red);
    }
    
    .email-tag {
      display: inline-flex;
      align-items: center;
      background: var(--lg-accent);
      color: white;
      padding: 0.375rem 0.75rem;
      border-radius: 15px;
      font-size: 0.85rem;
      margin: 0.25rem;
      gap: 0.375rem;
    }
    
    .email-tag .remove-tag {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
    }
    
    .hidden {
      display: none !important;
    }
    
    .section-disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    
    @media print {
      body { font-size: 12px; }
      .card { box-shadow: none; border: 1px solid #ddd; }
      .section { break-inside: avoid; }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="max-w-4xl mx-auto p-6">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-red-800 mb-2">LG Science Park 방문 안내</h1>
      <p class="text-gray-600">강사님을 위한 방문 안내 시스템</p>
    </div>

    <!-- 방문포탈 접속 안내 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-info-circle"></i> 방문포탈 접속 안내
        </h2>
        <p class="mb-4">LG Science Park 방문을 위해서는 반드시 <strong>방문포탈에서 출입 등록/예약</strong>을 사전에 완료해 주셔야 합니다.</p>
        <a href="https://visit.lg.com/" target="_blank" class="btn btn-primary inline-block mb-4">
          <i class="fas fa-external-link-alt mr-2"></i>방문포탈 접속하기
        </a>
        
        <div class="bg-gray-50 p-4 rounded-lg mb-4">
          <h3 class="font-bold mb-3">주요 안내 사항</h3>
          <ul class="space-y-2">
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-red-600 mt-1"></i>
              <span>방문 포털 접속하여 비회원 방문 예약으로 진행해 주세요.</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-red-600 mt-1"></i>
              <span>노트북 등 기타 전자기기는 반입물품 정보에 필수 입력하셔야 합니다. (봉인 예외여부 체크 X)</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-red-600 mt-1"></i>
              <span>LG 방문신청 서비스 약관: 모두 동의</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-red-600 mt-1"></i>
              <span>방문장소: LG전자 마곡</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-red-600 mt-1"></i>
              <span>운영자 정보 참고</span>
            </li>
            <li class="flex items-start gap-2">
              <i class="fas fa-check-circle text-red-600 mt-1"></i>
              <span>방문날짜: 강의 기간으로 설정 (사전 점검 필요한 경우 해당 기간 포함)</span>
            </li>
          </ul>
        </div>
        
        <div>
          <h3 class="font-bold mb-3">운영자 정보</h3>
          <div class="flex flex-wrap">
            <span class="operator-badge">김미진<span class="num">7477</span></span>
            <span class="operator-badge">정하연<span class="num">6894</span></span>
            <span class="operator-badge">선송이<span class="num">7020</span></span>
            <span class="operator-badge">유지혜<span class="num">0530</span></span>
            <span class="text-sm text-gray-600 ml-2">*교육서비스센터</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 실습 자료 업로드 -->
    <div class="section">
      <div class="card" id="program-upload-section">
        <h2 class="section-title">
          <i class="fas fa-laptop-code"></i> 실습 자료 업로드
        </h2>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">파일/프로그램 공유</label>
          <div id="upload-container" class="drag-drop-area">
            <div id="upload-placeholder">
              <i class="fas fa-cloud-upload-alt text-3xl text-red-600 mb-2"></i>
              <p class="text-lg font-semibold mb-1">파일을 이곳에 끌어다 놓거나 클릭하여 업로드하세요</p>
              <p class="text-sm text-gray-500">용량 제한 없음 · 다중 파일 업로드 지원 · 모든 파일 형식 지원 (압축파일 포함)</p>
            </div>
            <div id="program-file-list" class="w-full"></div>
            <input type="file" id="file-upload" class="hidden" multiple accept="*/*">
          </div>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">설치 프로그램 설명</label>
          <textarea id="program-desc" class="form-control" rows="4" placeholder="수업 중 사용할 실습용 프로그램, 코드 예제, 설치 파일 등을 업로드해주세요.&#10;교육생들이 사전에 다운로드하여 실습 환경을 준비할 수 있습니다.&#10;&#10;- Python 3.9 설치 파일&#10;- 실습용 코드 예제 파일&#10;- 개발 환경 설정 가이드"></textarea>
        </div>
        
        <div class="checkbox-item">
          <input type="checkbox" id="no-installation">
          <label for="no-installation" class="text-sm">해당사항 없음</label>
        </div>
      </div>
    </div>

    <!-- 교재 제공 방식 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-book"></i> 교재 제공 방식
        </h2>
        
        <div class="space-y-2 mb-4">
          <div class="checkbox-item">
            <input type="checkbox" id="material-pdf" name="material_type" value="PDF">
            <label for="material-pdf">PDF 교재</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="material-paper" name="material_type" value="서면">
            <label for="material-paper">서면 교재</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="material-none" name="material_type" value="없음">
            <label for="material-none">해당사항 없음</label>
          </div>
        </div>
        
        <div id="pdf-upload-container" class="drag-drop-area hidden mb-4">
          <div id="pdf-placeholder">
            <i class="fas fa-file-pdf text-3xl text-red-600 mb-2"></i>
            <p class="text-lg font-semibold mb-1">PDF 교재를 이곳에 끌어다 놓거나 클릭하여 업로드하세요</p>
            <p class="text-sm text-gray-500 mb-1">용량 제한 없음 · 모든 파일 형식 지원 (압축파일 포함)</p>
            <p class="text-xs text-gray-400">강사명_교재.pdf</p>
          </div>
          <div id="pdf-file-list" class="w-full"></div>
          <input type="file" id="pdf-upload" class="hidden" multiple accept="*/*">
        </div>
        
        <div id="paper-material-info" class="hidden bg-gray-50 p-4 rounded-lg">
          <p class="font-semibold mb-2">교재 배송지:</p>
          <p class="mb-2">서울 강서구 마곡중앙로 10로 10, W10동 지하1층 메일센터</p>
          <a href="https://map.naver.com/p/search/LG사이언스파크%20W10동/place/1948693696?c=15.00,0,0,0,dh&isCorrectAnswer=true" target="_blank" class="text-blue-600 hover:underline">
            <i class="fas fa-map-marker-alt mr-1"></i> 지도보기
          </a>
        </div>
      </div>
    </div>

    <!-- 강사 정보 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-user-tie"></i> 강사 정보
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">업체명 <span class="text-red-500">*</span></label>
            <input type="text" id="company-name" class="form-control" placeholder="LG전자" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">성함 <span class="text-red-500">*</span></label>
            <input type="text" id="instructor-name" class="form-control" placeholder="김엘지" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">연락처 <span class="text-red-500">*</span></label>
            <input type="tel" id="phone-number" class="form-control" placeholder="010-1234-5678" required>
          </div>
        </div>
      </div>
    </div>

    <!-- 반입 장비 정보 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-laptop"></i> 반입 장비 정보
        </h2>
        
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
          <p class="text-blue-800 font-semibold mb-2"><i class="fas fa-wifi mr-2"></i>무선랜 게스트망 연결을 위해 MAC 주소 정보가 필수입니다.</p>
          <p class="text-blue-700 mb-2">노트북의 MAC 주소는 cmd 창에서 'ipconfig /all'로 확인 가능합니다.</p>
          <p class="text-blue-600">외장하드 등 저장매체는 원칙상 반입이 불가합니다. 필요 시 아래 해당 항목을 체크하고 사유를 기입해 주세요.</p>
        </div>
        
        <div id="equipment-container">
          <div class="equipment-row">
            <select class="form-control" name="equipment_type">
              <option value="">장비 유형 선택</option>
              <option value="노트북">노트북</option>
              <option value="네트워크장비">네트워크장비</option>
              <option value="NAS">NAS</option>
              <option value="데스크탑">데스크탑</option>
              <option value="스마트패드">스마트패드</option>
              <option value="샘플폰">샘플폰</option>
              <option value="서버장비">서버장비</option>
              <option value="태블릿PC">태블릿PC</option>
              <option value="AP">AP</option>
              <option value="CD">CD</option>
              <option value="디지털카메라">디지털카메라</option>
              <option value="DVD">DVD</option>
              <option value="기타">기타</option>
              <option value="HDD/SSD">HDD/SSD</option>
              <option value="모바일폰">모바일폰</option>
              <option value="메모리카드">메모리카드</option>
              <option value="USB">USB</option>
              <option value="워크스테이션">워크스테이션</option>
            </select>
            <input type="text" class="form-control" name="equipment_manufacturer" placeholder="제조사">
            <input type="text" class="form-control" name="equipment_model" placeholder="기종">
            <input type="number" class="form-control" name="equipment_quantity" min="1" value="1" placeholder="수량">
            <input type="text" class="form-control" name="equipment_serial" placeholder="S/N & MAC주소">
            <button type="button" class="equipment-remove btn btn-secondary">
              <i class="fas fa-minus"></i>
            </button>
          </div>
        </div>
        
        <button type="button" id="add-equipment" class="btn btn-secondary mb-4">
          <i class="fas fa-plus mr-2"></i> 장비 추가
        </button>
        
        <div class="mb-4">
          <div class="checkbox-item mb-2">
            <input type="checkbox" id="storage-media-check">
            <label for="storage-media-check" class="font-semibold">USB 등 저장매체 반입이 필요한 경우</label>
          </div>
          <textarea id="storage-media-info" class="form-control hidden" rows="3" placeholder="저장매체 종류 및 개수, 반입 사유를 상세히 작성해 주세요."></textarea>
        </div>
        
        <div>
          <div class="checkbox-item mb-2">
            <input type="checkbox" id="lan-port-check">
            <label for="lan-port-check" class="font-semibold">LAN Port 해제가 필요한 경우</label>
          </div>
          <div id="lan-port-fields" class="hidden flex gap-4">
            <select class="form-control" name="lan_port_type">
              <option value="">유형 선택</option>
              <option value="USB">USB</option>
              <option value="LAN">LAN</option>
              <option value="SD카드">SD카드</option>
              <option value="카메라">카메라</option>
              <option value="기타">기타</option>
            </select>
            <input type="text" class="form-control" name="lan_port_detail" placeholder="추가 상세 정보">
          </div>
        </div>
      </div>
    </div>

    <!-- 차량 정보 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-car"></i> 차량 정보 입력
        </h2>
        
        <p class="mb-4">주차가 필요한 경우 차량 정보를 입력해 주세요.</p>
        
        <div id="vehicle-container">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">차종</label>
              <input type="text" class="form-control" name="vehicle_type" placeholder="그랜저">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">차량번호</label>
              <input type="text" class="form-control" name="vehicle_number" placeholder="12가 1234">
            </div>
          </div>
        </div>
        
        <div class="flex justify-between items-center">
          <button type="button" id="add-vehicle" class="btn btn-secondary">
            <i class="fas fa-plus mr-2"></i> 차량 추가
          </button>
          <div class="checkbox-item">
            <input type="checkbox" id="no-vehicle">
            <label for="no-vehicle">해당사항 없음</label>
          </div>
        </div>
      </div>
    </div>

    <!-- 수신자 정보 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-envelope"></i> 수신자 정보
        </h2>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">메일을 받을 담당자 선택</label>
          <select id="operator-email" class="form-control" required>
            <option value="">이메일을 보낼 운영자를 선택하세요</option>
            <option value="mijin1.kim@lgepartner.com">김미진 - mijin1.kim@lgepartner.com</option>
            <option value="songyi.seon@lge.com">선송이 - songyi.seon@lge.com</option>
            <option value="jihye.yoo@lgepartner.com">유지혜 - jihye.yoo@lgepartner.com</option>
            <option value="hayeon.jung@lgepartner.com">정하연 - hayeon.jung@lgepartner.com</option>
          </select>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">추가 수신자 이메일</label>
          <div class="flex gap-2">
            <input type="email" id="receiver-email-input" class="form-control" placeholder="추가 수신자 이메일 주소를 입력하세요">
            <button type="button" id="add-receiver-btn" class="btn btn-secondary">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <div id="receiver-tags-container" class="mt-2"></div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">참조자 이메일</label>
          <div class="flex gap-2">
            <input type="email" id="cc-email-input" class="form-control" placeholder="참조자 이메일 주소를 입력하세요">
            <button type="button" id="add-cc-btn" class="btn btn-secondary">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <div id="cc-tags-container" class="mt-2"></div>
        </div>
      </div>
    </div>

    <!-- 추가 문의사항 -->
    <div class="section">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-question-circle"></i> 추가 문의사항
        </h2>
        <textarea id="contact-message" class="form-control mb-4" rows="4" placeholder="추가 문의사항이 있으면 상세히 입력해 주세요"></textarea>
        <button type="button" id="submit-form" class="btn btn-primary">
          <i class="fas fa-paper-plane mr-2"></i>이메일 전송
        </button>
      </div>
    </div>
  </div>

  <script>
    // EmailJS 초기화
    emailjs.init('C56kGCzPtfgWVEKoO');

    // 전역 변수
    let uploadedFiles = { program: [], pdf: [] };
    let receiverEmails = [];
    let ccEmails = [];
    const API_BASE_URL = 'https://magok-guide-v673.vercel.app/api';

    // 파일 업로드 처리
    async function uploadToServer(files) {
      const formData = new FormData();
      
      files.forEach((file, index) => {
        formData.append(`file_${index}`, file);
      });

      try {
        const response = await fetch(`${API_BASE_URL}/upload`, {
          method: 'POST',
          body: formData,
          mode: 'cors'
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        return result;
      } catch (error) {
        console.error('파일 업로드 오류:', error);
        throw error;
      }
    }

    // 파일 처리
    async function handleFiles(files, fileType) {
      if (!files || files.length === 0) return;
      
      try {
        const result = await uploadToServer(Array.from(files));
        
        if (result.success && result.files) {
          result.files.forEach(file => {
            uploadedFiles[fileType].push({
              id: file.id,
              name: file.name,
              size: file.size,
              downloadUrl: file.downloadUrl
            });
          });
          
          alert(`${result.files.length}개 파일이 성공적으로 업로드되었습니다.`);
          renderFileList(fileType);
        } else {
          throw new Error(result.error || '업로드 실패');
        }
      } catch (error) {
        alert(`파일 업로드에 실패했습니다: ${error.message}`);
      }
    }

    // 파일 리스트 렌더링
    function renderFileList(fileType) {
      const listId = fileType === 'program' ? 'program-file-list' : 'pdf-file-list';
      const placeholderId = fileType === 'program' ? 'upload-placeholder' : 'pdf-placeholder';
      const fileList = document.getElementById(listId);
      const placeholder = document.getElementById(placeholderId);
     
      if (uploadedFiles[fileType].length === 0) {
        fileList.innerHTML = '';
        if (placeholder) placeholder.style.display = 'block';
      } else {
        if (placeholder) placeholder.style.display = 'none';
        fileList.innerHTML = uploadedFiles[fileType].map((file, index) => `
          <div class="file-item">
            <div class="file-info">
              <i class="${getFileIcon(file.name)} text-red-600"></i>
              <div>
                <div class="font-medium">${file.name}</div>
                <div class="text-xs text-gray-500">${formatFileSize(file.size)}</div>
              </div>
            </div>
            <button type="button" class="file-remove" onclick="removeFile('${fileType}', ${index})">
              <i class="fas fa-times"></i>
            </button>
          </div>
        `).join('');
      }
    }

    // 파일 제거
    function removeFile(fileType, index) {
      uploadedFiles[fileType].splice(index, 1);
      renderFileList(fileType);
    }

    // 파일 크기 포맷팅
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // 파일 아이콘
    function getFileIcon(fileName) {
      const ext = fileName.split('.').pop().toLowerCase();
      if (['pdf'].includes(ext)) return 'fas fa-file-pdf';
      if (['doc', 'docx'].includes(ext)) return 'fas fa-file-word';
      if (['xls', 'xlsx'].includes(ext)) return 'fas fa-file-excel';
      if (['ppt', 'pptx'].includes(ext)) return 'fas fa-file-powerpoint';
      if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'fas fa-file-image';
      if (['zip', 'rar', '7z'].includes(ext)) return 'fas fa-file-archive';
      return 'fas fa-file';
    }

    // 파일 업로드 설정
    function setupFileUpload(containerId, uploadId, fileType) {
      const container = document.getElementById(containerId);
      const fileInput = document.getElementById(uploadId);

      if (!container || !fileInput) return;

      container.addEventListener('click', (e) => {
        if (!e.target.closest('.file-item') && !e.target.closest('.file-remove') && !container.classList.contains('disabled')) {
          fileInput.click();
        }
      });

      container.addEventListener('dragover', (e) => {
        if (!container.classList.contains('disabled')) {
          e.preventDefault();
          container.classList.add('dragover');
        }
      });

      container.addEventListener('dragleave', () => {
        container.classList.remove('dragover');
      });

      container.addEventListener('drop', (e) => {
        if (!container.classList.contains('disabled')) {
          e.preventDefault();
          container.classList.remove('dragover');
          handleFiles(e.dataTransfer.files, fileType);
        }
      });

      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFiles(e.target.files, fileType);
          e.target.value = '';
        }
      });
    }

    // 이메일 관리
    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function addReceiverEmail(email) {
      if (!validateEmail(email)) {
        alert('올바른 이메일 형식이 아닙니다.');
        return false;
      }
      if (receiverEmails.includes(email)) {
        alert('이미 추가된 이메일입니다.');
        return false;
      }
      receiverEmails.push(email);
      updateReceiverTags();
      return true;
    }

    function updateReceiverTags() {
      const container = document.getElementById('receiver-tags-container');
      container.innerHTML = receiverEmails.map((email, index) => `
        <span class="email-tag">
          <i class="fas fa-user mr-1"></i>
          ${email}
          <button type="button" class="remove-tag" onclick="removeReceiverEmail('${email}')">
            <i class="fas fa-times"></i>
          </button>
        </span>
      `).join('');
    }

    function removeReceiverEmail(email) {
      receiverEmails = receiverEmails.filter(e => e !== email);
      updateReceiverTags();
    }

    function addCcEmail(email) {
      if (!validateEmail(email)) {
        alert('올바른 이메일 형식이 아닙니다.');
        return false;
      }
      if (ccEmails.includes(email)) {
        alert('이미 추가된 이메일입니다.');
        return false;
      }
      ccEmails.push(email);
      updateCcTags();
      return true;
    }

    function updateCcTags() {
      const container = document.getElementById('cc-tags-container');
      container.innerHTML = ccEmails.map((email, index) => `
        <span class="email-tag">
          <i class="fas fa-user mr-1"></i>
          ${email}
          <button type="button" class="remove-tag" onclick="removeCcEmail('${email}')">
            <i class="fas fa-times"></i>
          </button>
        </span>
      `).join('');
    }

    function removeCcEmail(email) {
      ccEmails = ccEmails.filter(e => e !== email);
      updateCcTags();
    }

    // 이벤트 리스너 설정
    document.addEventListener('DOMContentLoaded', function() {
      // 파일 업로드 초기화
      setupFileUpload('upload-container', 'file-upload', 'program');
      setupFileUpload('pdf-upload-container', 'pdf-upload', 'pdf');

      // 연락처 자동 포맷팅
      document.getElementById('phone-number').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length <= 3) {
          e.target.value = value;
        } else if (value.length <= 7) {
          e.target.value = value.slice(0, 3) + '-' + value.slice(3);
        } else {
          e.target.value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
        }
      });

      // 체크박스 이벤트
      document.getElementById('no-installation').addEventListener('change', function() {
        const uploadContainer = document.getElementById('upload-container');
        const programDesc = document.getElementById('program-desc');
        
        if (this.checked) {
          uploadContainer.classList.add('disabled');
          programDesc.classList.add('section-disabled');
        } else {
          uploadContainer.classList.remove('disabled');
          programDesc.classList.remove('section-disabled');
        }
      });

      document.getElementById('material-none').addEventListener('change', function() {
        const pdfContainer = document.getElementById('pdf-upload-container');
        const paperInfo = document.getElementById('paper-material-info');
        const pdfCheckbox = document.getElementById('material-pdf');
        const paperCheckbox = document.getElementById('material-paper');
        
        if (this.checked) {
          pdfCheckbox.checked = false;
          paperCheckbox.checked = false;
          pdfContainer.classList.add('hidden');
          paperInfo.classList.add('hidden');
        }
      });

      document.getElementById('material-pdf').addEventListener('change', function() {
        const container = document.getElementById('pdf-upload-container');
        const noneCheckbox = document.getElementById('material-none');
        
        if (this.checked) {
          container.classList.remove('hidden');
          noneCheckbox.checked = false;
        } else {
          container.classList.add('hidden');
        }
      });

      document.getElementById('material-paper').addEventListener('change', function() {
        const container = document.getElementById('paper-material-info');
        const noneCheckbox = document.getElementById('material-none');
        
        if (this.checked) {
          container.classList.remove('hidden');
          noneCheckbox.checked = false;
        } else {
          container.classList.add('hidden');
        }
      });

      document.getElementById('no-vehicle').addEventListener('change', function() {
        const vehicleContainer = document.getElementById('vehicle-container');
        const addVehicleBtn = document.getElementById('add-vehicle');
        
        if (this.checked) {
          vehicleContainer.classList.add('section-disabled');
          addVehicleBtn.classList.add('section-disabled');
        } else {
          vehicleContainer.classList.remove('section-disabled');
          addVehicleBtn.classList.remove('section-disabled');
        }
      });

      document.getElementById('storage-media-check').addEventListener('change', function() {
        const textarea = document.getElementById('storage-media-info');
        if (this.checked) {
          textarea.classList.remove('hidden');
        } else {
          textarea.classList.add('hidden');
        }
      });

      document.getElementById('lan-port-check').addEventListener('change', function() {
        const fields = document.getElementById('lan-port-fields');
        if (this.checked) {
          fields.classList.remove('hidden');
        } else {
          fields.classList.add('hidden');
        }
      });

      // 장비 추가
      document.getElementById('add-equipment').addEventListener('click', function() {
        const container = document.getElementById('equipment-container');
        const newRow = document.createElement('div');
        newRow.className = 'equipment-row';
        newRow.innerHTML = `
          <select class="form-control" name="equipment_type">
            <option value="">장비 유형 선택</option>
            <option value="노트북">노트북</option>
            <option value="네트워크장비">네트워크장비</option>
            <option value="NAS">NAS</option>
            <option value="데스크탑">데스크탑</option>
            <option value="스마트패드">스마트패드</option>
            <option value="샘플폰">샘플폰</option>
            <option value="서버장비">서버장비</option>
            <option value="태블릿PC">태블릿PC</option>
            <option value="AP">AP</option>
            <option value="CD">CD</option>
            <option value="디지털카메라">디지털카메라</option>
            <option value="DVD">DVD</option>
            <option value="기타">기타</option>
            <option value="HDD/SSD">HDD/SSD</option>
            <option value="모바일폰">모바일폰</option>
            <option value="메모리카드">메모리카드</option>
            <option value="USB">USB</option>
            <option value="워크스테이션">워크스테이션</option>
          </select>
          <input type="text" class="form-control" name="equipment_manufacturer" placeholder="제조사">
          <input type="text" class="form-control" name="equipment_model" placeholder="기종">
          <input type="number" class="form-control" name="equipment_quantity" min="1" value="1" placeholder="수량">
          <input type="text" class="form-control" name="equipment_serial" placeholder="S/N & MAC주소">
          <button type="button" class="equipment-remove btn btn-secondary">
            <i class="fas fa-minus"></i>
          </button>
        `;
        container.appendChild(newRow);
        
        newRow.querySelector('.equipment-remove').addEventListener('click', function() {
          if (container.children.length > 1) {
            newRow.remove();
          }
        });
      });

      // 기존 장비 삭제
      document.querySelectorAll('.equipment-remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const container = document.getElementById('equipment-container');
          if (container.children.length > 1) {
            this.closest('.equipment-row').remove();
          }
        });
      });

      // 차량 추가
      document.getElementById('add-vehicle').addEventListener('click', function() {
        const container = document.getElementById('vehicle-container');
        const newVehicle = document.createElement('div');
        newVehicle.className = 'grid grid-cols-1 md:grid-cols-2 gap-4 mb-4';
        newVehicle.innerHTML = `
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">차종</label>
            <input type="text" class="form-control" name="vehicle_type" placeholder="그랜저">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">차량번호</label>
            <div class="flex gap-2">
              <input type="text" class="form-control" name="vehicle_number" placeholder="12가 1234">
              <button type="button" class="vehicle-remove btn btn-secondary">
                <i class="fas fa-minus"></i>
              </button>
            </div>
          </div>
        `;
        container.appendChild(newVehicle);
        
        newVehicle.querySelector('.vehicle-remove').addEventListener('click', function() {
          newVehicle.remove();
        });
      });

      // 이메일 추가 버튼
      document.getElementById('add-receiver-btn').addEventListener('click', function() {
        const email = document.getElementById('receiver-email-input').value.trim();
        if (email && addReceiverEmail(email)) {
          document.getElementById('receiver-email-input').value = '';
        }
      });

      document.getElementById('add-cc-btn').addEventListener('click', function() {
        const email = document.getElementById('cc-email-input').value.trim();
        if (email && addCcEmail(email)) {
          document.getElementById('cc-email-input').value = '';
        }
      });

      // 폼 제출
      document.getElementById('submit-form').addEventListener('click', function() {
        const operatorEmail = document.getElementById('operator-email').value;
        const additionalReceivers = receiverEmails;
        
        if (!operatorEmail && additionalReceivers.length === 0) {
          alert('수신자를 선택하거나 추가해주세요.');
          return;
        }

        const allReceivers = [];
        if (operatorEmail) allReceivers.push(operatorEmail);
        allReceivers.push(...additionalReceivers);

        const materialTypes = [];
        if (document.getElementById('material-pdf').checked) materialTypes.push('PDF 교재');
        if (document.getElementById('material-paper').checked) materialTypes.push('서면 교재');
        if (document.getElementById('material-none').checked) materialTypes.push('해당사항 없음');

        const equipmentRows = document.querySelectorAll('.equipment-row');
        const equipmentList = [];
        equipmentRows.forEach(row => {
          const type = row.querySelector('[name="equipment_type"]').value;
          const manufacturer = row.querySelector('[name="equipment_manufacturer"]').value;
          const model = row.querySelector('[name="equipment_model"]').value;
          const quantity = row.querySelector('[name="equipment_quantity"]').value;
          const serial = row.querySelector('[name="equipment_serial"]').value;
          if (type) {
            equipmentList.push(`${type} ${manufacturer || ''} ${model || ''} ${quantity || 1}대 (${serial || ''})`.trim());
          }
        });

        let vehicleInfo = '';
        if (document.getElementById('no-vehicle').checked) {
          vehicleInfo = '해당사항 없음';
        } else {
          const vehicles = [];
          const vehicleInputs = document.querySelectorAll('[name="vehicle_type"], [name="vehicle_number"]');
          for (let i = 0; i < vehicleInputs.length; i += 2) {
            const type = vehicleInputs[i].value;
            const number = vehicleInputs[i + 1].value;
            if (type || number) {
              vehicles.push(`${type || ''} ${number || ''}`.trim());
            }
          }
          vehicleInfo = vehicles.length > 0 ? vehicles.join(', ') : '없음';
        }

        const templateParams = {
          to_email: allReceivers.join(','),
          instructor_name: document.getElementById('instructor-name').value,
          company: document.getElementById('company-name').value,
          phone: document.getElementById('phone-number').value,
          equipment_list: equipmentList.join('\n') || '없음',
          vehicle_info: vehicleInfo,
          material_type: materialTypes.join(', ') || '선택 안함',
          timestamp: new Date().toLocaleString('ko-KR')
        };

        if (ccEmails.length > 0) {
          templateParams.cc = ccEmails.join(',');
        }

        const programDesc = document.getElementById('program-desc').value;
        if (programDesc && !document.getElementById('no-installation').checked) {
          templateParams.program_description = programDesc;
        }

        if (uploadedFiles.program.length > 0) {
          templateParams.program_files = uploadedFiles.program.map(f => `${f.name} (${formatFileSize(f.size)})`).join('\n');
        }

        if (uploadedFiles.pdf.length > 0) {
          templateParams.material_files = uploadedFiles.pdf.map(f => `${f.name} (${formatFileSize(f.size)})`).join('\n');
        }

        const storageInfo = document.getElementById('storage-media-info').value;
        if (storageInfo && document.getElementById('storage-media-check').checked) {
          templateParams.storage_media_info = storageInfo;
        }

        const lanPortType = document.querySelector('[name="lan_port_type"]').value;
        const lanPortDetail = document.querySelector('[name="lan_port_detail"]').value;
        if (lanPortType && document.getElementById('lan-port-check').checked) {
          templateParams.lan_port_info = `${lanPortType} ${lanPortDetail}`.trim();
        }

        const inquiry = document.getElementById('contact-message').value;
        if (inquiry) {
          templateParams.inquiry = inquiry;
        }

        emailjs.send('ldd_Training Service', 'template_ajf77x7', templateParams)
          .then(function(response) {
            alert('이메일이 성공적으로 전송되었습니다!');
            console.log('SUCCESS!', response.status, response.text);
          })
          .catch(function(error) {
            alert('이메일 전송에 실패했습니다. 다시 시도해주세요.');
            console.log('FAILED...', error);
          });
      });
    });
  </script>
</body>
</html>

